library(dplyr)
library(ggplot2)
library(reshape2)
library(tidyr)
library(xlsx)
library("readxl")

Sys.setlocale(category = "LC_ALL", locale = "Greek")# To be able to read the greek names of columns

read.xlsx()
# We skip the first row while inserting all except one data file.
fires_2000 = read_xlsx(file.choose(), skip = 1, sheet = 1)
fires_2001 = read_xlsx(file.choose(), skip = 1, sheet = 2)
fires_2002 = read_xlsx(file.choose(), skip = 1, sheet = 3)
fires_2003 = read_xlsx(file.choose(), skip = 1, sheet = 4)
fires_2004 = read_xlsx(file.choose(), skip = 1, sheet = 5)
fires_2005 = read_xlsx(file.choose(), skip = 1, sheet = 6)
fires_2006 = read_xlsx(file.choose(), skip = 1, sheet = 7)
fires_2007 = read_xlsx(file.choose(), skip = 1, sheet = 8)
fires_2008 = read_xlsx(file.choose(), skip = 1, sheet = 9)
fires_2009 = read_xlsx(file.choose(), skip = 1, sheet = 10)
fires_2010 = read_xlsx(file.choose(), skip = 1, sheet = 11)
fires_2011 = read_xlsx(file.choose(), skip = 1, sheet = 12)
fires_2012 = read_xlsx(file.choose(), skip = 1, sheet = 13)
fires_2013 = read_xlsx(file.choose(), skip = 1)
fires_2014 = read_xlsx(file.choose())
fires_2015 = read_excel(file.choose(),skip = 1)
fires_2016 = read_xlsx(file.choose(), skip = 1)
fires_2017 = read_xlsx(file.choose(), skip = 1)
fires_2018 = read_xlsx(file.choose(), skip = 1)
fires_2019 = read_xlsx(file.choose(), skip = 1)
fires_2020 = read_xlsx(file.choose(), skip = 1)
fires_2021 = read_xlsx(file.choose(), skip = 1)


temp_annual = read_xlsx(file.choose())
temp_prec_month = read_xlsx(file.choose())
prec_annual = read_xlsx(file.choose())
str(prec_annual)
prec_annual$T22[1:40]
names(prec_annual)

temp_prec_month%>%
  ggplot(aes(x = factor(c(1:12), month.abb[1:12]), y = `Mean-Temperature`))+
  geom_line(group = 1)


temp_annual%>%
  filter(Category >= 2000)%>%
  ggplot(aes(x = as.factor(Category), y = `Annual Mean`))+
  geom_line( size = 2, group = 1)+
  theme(axis.text.x = element_text(angle = 90))


fires_2021%>%
  filter(?????????? == '??????????????')%>%
  group_by(??????????????????)%>%
  summarise(total_acres = sum(???????? +`???????????? ????????????`))


# Barplot of number of fires through the years under investigation.

df = data.frame('year' = c('2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012'
                           ,'2013','2014','2015','2016','2017','2018','2019','2020','2021'),
                no_of_fires = c(nrow(fires_2000),nrow(fires_2001),nrow(fires_2002),nrow(fires_2003),nrow(fires_2004),
                                nrow(fires_2005),nrow(fires_2006),nrow(fires_2007),nrow(fires_2008),nrow(fires_2009),
                                nrow(fires_2010),nrow(fires_2011),nrow(fires_2012),nrow(fires_2013),nrow(fires_2014), 
                                nrow(fires_2015),nrow(fires_2016),nrow(fires_2017), nrow(fires_2018), nrow(fires_2019),
                                nrow(fires_2020), nrow(fires_2021)))

plot_1 =
df %>%
  ggplot(aes(x = year, y = no_of_fires, fill = no_of_fires))+
  geom_col(width = 0.3, alpha = 1)+
  labs(title = 'Number of Fires in Greece', x = 'Year', y = 'No.Fires',
       subtitle = 'between 2014 and 2021', caption = 'Source: fireservice.gr')+
  theme(panel.background = element_rect(fill = 'white'),
        legend.position =  'none',
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -28, b = 0, l = 0), hjust = 1.2, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_line(linetype = 'dotted'),
        axis.line.y = element_line(linetype = 'dotted'))+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')+
  coord_flip()


plot_2 = 
  df %>%
  ggplot(aes(x = year, y = no_of_fires, fill = no_of_fires))+
  geom_col(width = 0.3, alpha = 1)+
  labs(title = 'Number of Fires in Greece', x = 'Year', y = 'No.Fires',
       subtitle = 'between 2014 and 2021', caption = 'Source: fireservice.gr')+
  theme(panel.background = element_rect(fill = 'white'),
        legend.position =  'none',
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -28, b = 0, l = 0), hjust = 1.2, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_line(linetype = 'dotted'),
        axis.line.y = element_line(linetype = 'dotted'))+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')
  
grid.arrange(plot_1,plot_2)



# Firefighters vs Volunteers(NON INTEREST)

df_1 = data.frame(Year = c('2014','2015','2016','2017','2018','2019','2020','2021'),
                  fire_fighters = c(mean(fires_2014$`??????????. ????????`, na.rm = TRUE), mean(fires_2015$`??????????. ????????`, na.rm = TRUE), mean(fires_2016$`??????????. ????????`,na.rm = TRUE),
                                  mean(fires_2017$`??????????. ????????`,na.rm = TRUE), mean(fires_2018$`??????????. ????????`), mean(fires_2019$`??????????. ????????`, na.rm = TRUE),
                                  mean(fires_2020$`??????????. ????????`, na.rm = TRUE), mean(fires_2021$`??????????. ????????`)),
                  volunt = c(mean(fires_2014$`??????????-????????`), mean(fires_2015$`??????????-????????`), mean(fires_2016$`??????????-????????`),
                             mean(fires_2017$`??????????-????????`, na.rm = TRUE), mean(fires_2018$`??????????-????????`), mean(fires_2019$`??????????-????????`),
                             mean(fires_2020$`??????????-????????`, na.rm = TRUE), mean(fires_2021$`??????????-????????`)))%>%
  gather(fire_fighters, volunt, key = 'key', value = 'value')

df_1 %>%
  ggplot(aes(x = Year))+
  geom_col(aes(y = value, fill = key))+
  scale_fill_manual(values = c('red', 'black'))



# Forest Area Burnt(???????????? ????????????)

df_2 = data.frame(forest_area_burnt = c(sum(fires_2000$`???????????? ????????????`),sum(fires_2001$`???????????? ????????????`),sum(fires_2002$`???????????? ????????????`),
                                        sum(fires_2003$`???????????? ????????????`),sum(fires_2004$`???????????? ????????????`),sum(fires_2005$`???????????? ????????????`),
                                        sum(fires_2006$`???????????? ????????????`),sum(fires_2007$`???????????? ????????????`),sum(fires_2008$`???????????? ????????????`),
                                        sum(fires_2009$`???????????? ????????????`),sum(fires_2010$`???????????? ????????????`),sum(fires_2011$`???????????? ????????????`),
                                        sum(fires_2012$`???????????? ????????????`),sum(fires_2013$`???????????? ????????????`),sum(fires_2014$`???????????? ????????????`),
                                        sum(fires_2015$`???????????? ????????????`), sum(fires_2016$`???????????? ????????????`),sum(fires_2017$`???????????? ????????????`),
                                        sum(fires_2018$`???????????? ????????????`),sum(fires_2019$`???????????? ????????????`),sum(fires_2020$`???????????? ????????????`),
                                        sum(fires_2021$`???????????? ????????????`)),
                  Year = c('2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012'
                           ,'2013','2014','2015','2016','2017','2018','2019','2020','2021'))
plot_3 = 
  df_2%>%
  ggplot(aes(x = Year, y = forest_area_burnt))+
  geom_col(width = 0.4, fill = 'darkgreen')+
  theme(panel.background = element_rect(fill = 'white'),
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -28, b = 0, l = 0), hjust = 1.2, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_line(linetype = 'dotted'),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_line(linetype = 'dotted'),
        axis.line.y = element_line(linetype = 'dotted'))+
  labs(title = 'Forest area burnt', subtitle =  'during Fires in Greece (2014-2021)', y = 'Area in acres',
       caption = 'Source: fireservice.gr')


grid.arrange(plot_1,plot_3)




# Forest Area Burnt (vol.2)(???????????? ????????????)

df_3 = 
  df_2 %>%
  mutate(fires = df$no_of_fires)

plot_4 = 
  df_3%>%
  ggplot(aes(x = Year))+
  geom_area(aes(y = forest_area_burnt/1000),fill = 'black', alpha = 0.4, group = 1)+
  annotate('text', x  = 20.7, y = 20, label = 'Acres Burned', fontface = 2)+
  geom_line(aes(y = fires/100), colour = 'red4', group = 1, size = 1.8)+
  #geom_point(aes(y = fires/100),  size = 2)+
  annotate(geom = "curve", x = 2.5, y = 150, xend = 3.5, yend = 110, 
    curvature = 0, arrow = arrow(length = unit(2, "mm"))) +
  annotate(geom = "text", x = 3, y = 151, label = "Fires", hjust = "left", fontface = 2)+
  theme(panel.background = element_rect(fill = 'white'),
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y.left  = element_text(size = 11, margin = margin(t = 15, r = -80, b = 0, l = 0), 
                                         hjust = 1.2, face = 'italic', angle = 0, vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_line(linetype = 'dotted', colour = 'black'),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_line(linetype = 'solid'),
        axis.line.y = element_line(linetype = 'solid'),
        axis.title.y.right = element_text(size = 11, margin = margin(t =0, r = 5, b = 0, l = -80), 
                                          hjust = 0, face = 'italic', angle = 0, vjust = 1.05, colour = 'grey2'))+
  labs(title = 'Annual Wildfires and Acres Burned', subtitle =  'in Greece between 2000 and 2021',
       caption = 'Source: fireservice.gr')+
  scale_y_continuous("Acres, in thousands", sec.axis = sec_axis(~ . * 0.1, name = 'Fires, in thousands'))

plot_4



# Forest Area Burnt (vol.3)(???????? + ?????????????? ????????????????)

Sys.setlocale(category = "LC_ALL", locale = "Greek")
df_4 = data.frame(forest_burnt = c(sum(fires_2000$????????),sum(fires_2001$????????),sum(fires_2002$????????),
                                        sum(fires_2003$????????),sum(fires_2004$????????),sum(fires_2005$????????),
                                        sum(fires_2006$????????),sum(fires_2007$????????),sum(fires_2008$????????),
                                        sum(fires_2009$????????, na.rm = TRUE),sum(fires_2010$????????),sum(fires_2011$????????),
                                        sum(fires_2012$????????),sum(fires_2013$????????),sum(fires_2014$????????),
                                        sum(fires_2015$????????), sum(fires_2016$????????),sum(fires_2017$????????),
                                        sum(fires_2018$????????),sum(fires_2019$????????),sum(fires_2020$????????),
                                        sum(fires_2021$????????)),
                  Year = c('2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012'
                           ,'2013','2014','2015','2016','2017','2018','2019','2020','2021'))

df_5 = 
  df_4 %>%
  mutate(fires = df$no_of_fires, forest_area_burnt = df_2$forest_area_burnt,
         forest_area_aggregate = forest_area_burnt + forest_burnt)

plot_5 = 
  df_5%>%
  ggplot(aes(x = Year))+
  geom_area(aes(y = forest_area_aggregate/1000),fill = 'grey', alpha = 1, group = 1)+
  annotate('text', x  = 20.8, y = 30, label = 'Acres Burned', fontface = 2)+
  geom_line(aes(y = fires/10), colour = 'red4', group = 1, size = 1.8)+
  #geom_point(aes(y = fires/100),  size = 2)+
  annotate(geom = "curve", x = 3, y = 1100, xend = 3.5, yend = 1000, 
           curvature = 0, arrow = arrow(length = unit(2, "mm"))) +
  annotate(geom = "text", x = 3.2, y = 1102, label = "Fires", hjust = "left", fontface = 2)+
  theme(panel.background = element_rect(fill = 'white'),
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y.left  = element_text(size = 11, margin = margin(t = 15, r = -25, b = 0, l = 0), 
                                          hjust = 1.2, face = 'italic', angle = 0, vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_line(linetype = 'dotted', colour = 'black'),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_line(linetype = 'solid'),
        axis.line.y = element_line(linetype = 'solid'),
        axis.title.y.right = element_text(size = 11, margin = margin(t =0, r = 5, b = 0, l = -80), 
                                          hjust = 0, face = 'italic', angle = 0, vjust = 1.05, colour = 'grey2'))+
  labs(title = 'Annual Wildfires and Acres Burned', subtitle =  'in Greece between 2000 and 2021',
       caption = 'Source: fireservice.gr')+
  scale_y_continuous("Acres", sec.axis = sec_axis(~ . * 0.01, name = 'Fires, in thousands'))

plot_5



# The three biggest wildfires between 2000-2021 (2000, 2007, 2021)

# Fires, Acres Burnt etc per Region in 2021

unique(fires_2021$??????????)# To get the dinstinct regions
fires_2021$?????????? = as.factor(fires_2021$??????????)

acres_burnt_per_region_2021 = 
fires_2021%>%
  group_by(??????????)%>%
  summarise(acres_1 = sum(`???????????? ????????????`), acres_2 = sum(????????))%>%
  mutate(acres_burnt_aggreagte = acres_1 + acres_2)


acres_burnt_per_region_2021$?????????? = as.factor(acres_burnt_per_region$??????????)

acres_burnt_per_region_2021%>%
  ggplot(aes(x = ??????????, y = acres_burnt_aggreagte/1000, fill = acres_burnt_aggreagte))+
  geom_col(width = 0.3)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.x  = element_line(linetype = 'dotted', colour = 'black'),
        legend.position =  'none',
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -97, b = 0, l = 70),
                                    hjust = 1, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 10, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5, margin = margin(t = 0, r = 0, b = 20, l = 0)),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'))+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')+
  labs(title = 'Acres Burnt per Region', subtitle = 'in 2021 WildFires in Greece', caption = 'Source: fireservice.gr',
       y = 'Acres', x = 'Region')+
  coord_flip()



# Fires, Acres Burnt etc per Region in 2007

acres_burnt_per_region_2007 = 
  fires_2007%>%
  group_by(??????????)%>%
  summarise(forest_area_burnt = sum(`???????????? ????????????`), forest_burnt = sum(????????))%>%
  mutate(acres_burnt_aggreagte = forest_area_burnt + forest_burnt)


acres_burnt_per_region_2007$?????????? = as.factor(acres_burnt_per_region_2007$??????????)

acres_burnt_per_region_2007%>%
  ggplot(aes(x = ??????????, y = acres_burnt_aggreagte/1000, fill = acres_burnt_aggreagte))+
  geom_col(width = 0.3)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.x  = element_line(linetype = 'dotted', colour = 'black'),
        legend.position =  'none',
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -97, b = 0, l = 70),
                                    hjust = 1, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 10, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5, margin = margin(t = 0, r = 0, b = 20, l = 0)),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'))+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')+
  labs(title = 'Acres Burnt per Region', subtitle = 'in 2007 WildFires in Greece', caption = 'Source: fireservice.gr',
       y = 'Acres', x = 'Region')+
  coord_flip()



# Fires, Acres Burnt etc per Region in 2000

acres_burnt_per_region_2000 = 
  fires_2000%>%
  group_by(??????????)%>%
  summarise(forest_area_burnt = sum(`???????????? ????????????`), forest_burnt = sum(????????))%>%
  mutate(acres_burnt_aggreagte = forest_area_burnt + forest_burnt)


acres_burnt_per_region_2007$?????????? = as.factor(acres_burnt_per_region_2007$??????????)

acres_burnt_per_region_2000%>%
  ggplot(aes(x = ??????????, y = acres_burnt_aggreagte/1000, fill = acres_burnt_aggreagte))+
  geom_col(width = 0.3)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.x  = element_line(linetype = 'dotted', colour = 'black'),
        legend.position =  'none',
        axis.title.x = element_text(size = 11, margin = margin(t = 15, r = 0, b = 0, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.title.y = element_text(size = 11, margin = margin(t = 15, r = -97, b = 0, l = 70),
                                    hjust = 1, face = 'bold', angle = 0,vjust = 1.05),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 10, r = 20, b = 10, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5, margin = margin(t = 0, r = 0, b = 20, l = 0)),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'))+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')+
  labs(title = 'Acres Burnt per Region', subtitle = 'in 2000 WildFires in Greece', caption = 'Source: fireservice.gr',
       y = 'Acres', x = 'Region')+
  coord_flip()



# Most Affected Regions by WildFires.(All Acres)

Sys.setlocale(category = "LC_ALL", locale = "Greek")
fires_2021_fixed = subset(fires_2021, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2020_fixed = subset(fires_2020, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2019_fixed = subset(fires_2019, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2018_fixed = subset(fires_2018, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2017_fixed = subset(fires_2017, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2016_fixed = subset(fires_2016, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2015_fixed = subset(fires_2015, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2014_fixed = subset(fires_2014, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2013_fixed = subset(fires_2013, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2012_fixed = subset(fires_2012, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2011_fixed = subset(fires_2011, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,????????,
                                                 `?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????,
                                                 `??????????. ????????`,`??????????. ????????.`,`????????. ??????`,`??????????- ??????????`,
                                                 `??/?? CL415`,`??/?? CL215`,`??/?? PZL`,`??/?? GRU.`))
 
fires_2010_fixed = subset(fires_2010, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2009_fixed = subset(fires_2009, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2008_fixed = subset(fires_2008, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2007_fixed = subset(fires_2007, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2006_fixed = subset(fires_2006, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2005_fixed = subset(fires_2005, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2004_fixed = subset(fires_2004, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2003_fixed = subset(fires_2003, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2002_fixed = subset(fires_2002, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2001_fixed = subset(fires_2001, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2000_fixed = subset(fires_2000, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
                                                

names(fires_2021)[22] = '??????????????????????????'
names(fires_2020)[22] = '??????????????????????????'
names(fires_2019)[18] = '??????????????????????????' 
names(fires_2018)[18] = '??????????????????????????'
names(fires_2017)[18] = '??????????????????????????'
names(fires_2016)[18] = '??????????????????????????'
names(fires_2015)[18] = '??????????????????????????'
names(fires_2014)[18] = '??????????????????????????'
names(fires_2013)[18] = '??????????????????????????' 
names(fires_2012)[18] = '??????????????????????????'



fires_2021_fixed_1 = subset(fires_2021, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2020_fixed_1 = subset(fires_2020, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2019_fixed_1 = subset(fires_2019, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2018_fixed_1 = subset(fires_2018, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2017_fixed_1 = subset(fires_2017, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2016_fixed_1 = subset(fires_2016, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2015_fixed_1 = subset(fires_2015, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2014_fixed_1 = subset(fires_2014, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2013_fixed_1 = subset(fires_2013, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2012_fixed_1 = subset(fires_2012, select = c(`????????/?????? ??????????????`, ??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))
fires_2011_fixed_1 = subset(fires_2011, select = c(`????????/?????? ??????????????`,??????????, ????????,`???????????? ????????????`,????????,`?????????????????? ????????????????`,`????????/?????? ????????????????`,`?????????????????????? ????????????????????????`,`?????????????? - ????????????`,??????????????????????????))


my_df = rbind(fires_2000_fixed, fires_2001_fixed, fires_2002_fixed, fires_2003_fixed, fires_2004_fixed, fires_2005_fixed,
              fires_2006_fixed, fires_2007_fixed, fires_2008_fixed, fires_2009_fixed, fires_2010_fixed, fires_2011_fixed_1,
              fires_2012_fixed_1, fires_2013_fixed_1, fires_2014_fixed_1, fires_2015_fixed_1, fires_2016_fixed_1, fires_2017_fixed_1,
              fires_2018_fixed_1, fires_2019_fixed_1, fires_2020_fixed_1, fires_2021_fixed_1)


my_df_1 = my_df %>%
  group_by(??????????)%>%
  summarise( burnt = sum(????????, na.rm = TRUE) + sum(`???????????? ????????????`, na.rm = TRUE)+
             sum(????????, na.rm = TRUE)+ sum(`?????????????????? ????????????????`, na.rm = TRUE)+ sum(`????????/?????? ????????????????`, na.rm = TRUE)+
            sum(`?????????????????????? ????????????????????????`, na.rm = TRUE) + sum(`?????????????? - ????????????`, na.rm = TRUE),sum(??????????????????????????, na.rm = TRUE))


my_df_1 = my_df_1%>%
  slice(-52)

plot_55 = 
my_df_1%>%
  ggplot(aes(x = ??????????, y = burnt/10000, fill = burnt/1000))+
  geom_hline(yintercept = c(0,50,100,150), linetype = 'solid', color = 'grey')+
  geom_col(width = 0.4)+
  labs(title = 'Most Affected Regions by Wildfires', subtitle = 'in Greece between 2000 and 2021',
       x = 'Region', y = 'Hectares, in thousands', caption = 'Source: fireservice.gr')+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(colour = 'black'),
        plot.title = element_text(hjust = 0.5, size = 12, face = 'bold', margin = margin(t=10, b=30, l=0, r=0)),
        plot.subtitle = element_text(hjust = 0.5 , face = 'italic',margin = margin(t=-23, b=30, l=0, r=0)),
        plot.caption =  element_text(face = 'italic', size = 8), 
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'), 
        axis.title.x = element_text(hjust=1, face = 'bold', margin = margin(t = 10)),
        axis.text.y = element_text(size = 6),
        axis.text.x = element_text(size = 10, face = 'bold'),
        axis.title.y = element_text(vjust = 1.05, face = 'bold', angle = 0, margin = margin(t=0,b=0,l=25,r=-64)),
        legend.position = 'none')+
  scale_fill_gradient(low = '#FFCC66', high = '#CC0000')+
  coord_flip()
  
plot_55

dev.size("in")
ggsave('ggtest.png', plot_55, width =  4.2, height = 6.7, dpi = 1200)

# All Acres Burnt

my_df = my_df%>%
  mutate(aggregate = (???????? + `???????????? ????????????` + ???????? + `?????????????????? ????????????????` + `????????/?????? ????????????????` + 
                            `?????????????????????? ????????????????????????` + `?????????????? - ????????????` + ??????????????????????????),
         year = format(`????????/?????? ??????????????`, "%Y"))

acres_burnt_per_year = my_df %>%
  group_by(year)%>%
  summarise(total = sum(aggregate, na.rm = TRUE), fires = n(), avg = mean(aggregate, na.rm = TRUE))


plot_7 = 
acres_burnt_per_year%>%
  ggplot(aes(x = as.factor(year)))+
  geom_area(aes(y = total/10000),fill = 'grey', alpha = 1, group = 1)+
  annotate('text', x  = 20, y = 10.75, label = 'Ha Burned', fontface = 2, size = 4)+
  geom_line(aes(y = fires/100), colour = 'red4', group = 1, size = 2.5)+
  #geom_point(aes(y = fires/100),  size = 2)+
  annotate(geom = "curve", x = 3.5, y = 115, xend = 4.5, yend = 110, 
           curvature = 0, arrow = arrow(length = unit(2, "mm"))) +
  annotate(geom = "text", x = 3.2, y = 130, label = "Fires", hjust = "left", fontface = 2, size = 5)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.border = element_rect(colour = 'black', fill = 'transparent', size = 2),
        axis.title.x = element_text(size = 8, margin = margin(t = 5, r = 0, b = -5, l = 20), hjust = 1,
                                    face = 'bold'),
        axis.text.x = element_text(angle = 90, size = 10, face = 'bold'), 
        axis.title.y.left  = element_text(size = 9.5, margin = margin(t = 0, r = -122, b = 0, l = 30), 
                                          face = 'italic', angle = 0, vjust = 1.07),
        plot.title = element_text(size = 14, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 5, r = 0, b = 2, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5, size = 7, margin = margin(b = 15)),
        panel.grid.major.y = element_line(colour = 'black', linetype = 'dotted'),
        #panel.grid.minor = element_line(linetype = 'dotted', colour = 'black'),
        plot.caption = element_text(face = 'italic', size = 3),
        axis.text.y = element_text(size = 12,face = 'bold', colour = 'black'),
        axis.title.y.right = element_text(size = 9.5, margin = margin(t =0, r = 19, b = 0, l = -100), 
                                          hjust = 0, face = 'italic', angle = 0, vjust = 1.07, colour = 'grey2'))+
  labs(title = 'Annual Wildfires and Hectares Burned', subtitle =  'in Greece between 2000 and 2021',
       caption = 'Source: fireservice.gr', x = 'Year')+
  scale_y_continuous(breaks = seq(0,250,50),"Hectares, in thousands", sec.axis = sec_axis(~ . * 0.1, name = 'Fires, in thousands', breaks = seq(0,25,5)))
  
plot_7

dev.size("in")

  
ggsave(
  "ggtest.png",
  plot_7,
  width = 6.2,
  height = 3.9,
  dpi = 1200
)



sum(fires_2020$`???????????? ????????????`)
# Firefighting Personnel and Equipment vs Acres Burnt (or fires)

pyrosv_vehicle_person = data.frame('Year' = c('2010','2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021'), 
                                   'personel' = c(48227,61824,60668,53642,36913,42278,55919,55886,40475,49813,60640,59158),
                                   'volunt' = c(2172,2903,3047,2079,1837,1718,2202,1853,1798,1498,1905,1747),
                                   'vehicles' = c(19782,26151,24873,23022,15843,17602,23564,24397,18074,22269,27142,25122),
                                   'aircrafts' = c(860, 1002, 1028, 720, 472, 413, 618, 728, 327, 600, 575, 709 ))
c_1 = 
  my_df%>%
  filter(year >= 2010)%>%
  select(year, aggregate)%>%
  group_by(year)%>%
  summarise(total  = sum(aggregate, na.rm = TRUE))%>%
  select(total)



pyrosv_vehicle_person['burned'] = c_1 

plot_8 = 
pyrosv_vehicle_person %>%
  ggplot(aes(x = as.factor(Year)))+
  geom_area(aes(y = burned/1000),fill = 'grey', alpha = 1, group = 1)+
  geom_line(aes(y = vehicles/100), size = 1.5, colour = 'black', group = 1)+
  annotate(geom = "curve", x = 3.3, y = 270, xend = 3.5, yend = 250, curvature = 0, 
           arrow = arrow(length = unit(2, "mm")))+
  annotate('text', x = 3.5, y = 285, label = 'Vehicles', fontface = 2)+
  geom_line(aes(y = personel/100), size = 1.5, colour = 'red', group = 1)+
  annotate(geom = "curve", x = 6.8, y = 580, xend = 7, yend = 565, curvature = 0, 
           arrow = arrow(length = unit(2, "mm")))+
  annotate('text', x = 7, y = 595, label = 'Personnel', fontface = 2)+
  labs(title = 'Firefighters and Vehicles operating vs Acres Burnt in WildFires', subtitle = 'in Greece between 2010-2021', x = 'Year',
       caption = 'Source: fireservice.gr')+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.y = element_line(linetype = 'dotted', colour = 'black'),
        plot.title = element_text(size = 16, hjust = 0.5, face = 'bold', 
                                  margin = margin(t = 45, r = 20, b = 30, l = 0)),
        plot.subtitle = element_text(face = 'italic',hjust = 0.5, margin = margin(t = -15, r = 0, b = 50, l = 0)),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'),
        axis.title.y.left = element_text(hjust = 1,vjust = 1.05, angle = 0, face = 'italic', margin = margin(t = 0, r = -70, b = 0, l = 0)),
        axis.title.y.right = element_text(hjust = 1,vjust = 1.05, angle = 0, face = 'italic', margin = margin(t = 15, r = 15, b = 0, l = -84)),
        axis.title.x = element_text(hjust = 1, face = 'bold', margin = margin(b=0, t=10)))+
  scale_y_continuous("Acres, in thousands", sec.axis = sec_axis(~ . /10, name = 'No of Vehicles \n& Personnel, in thousands'))

ggsave(
  "ggtest.png",
  plot_8,
  width = 16,
  height = 12,
  dpi = 1200
)

plot_8



# Average number of firefighters in every fire throughout 2011 to 2021. Also, average acres burnt per fire throughout 2000 to 2021.

Sys.setlocale(category = "LC_ALL", locale = "Greek")


my_df_2 = rbind(fires_2011_fixed,
                fires_2012_fixed, fires_2013_fixed, fires_2014_fixed, fires_2015_fixed, fires_2016_fixed, fires_2017_fixed,
                fires_2018_fixed, fires_2019_fixed, fires_2020_fixed, fires_2021_fixed)

my_df_2 = 
  my_df_2 %>%
  mutate(year = format(`????????/?????? ??????????????`, "%Y"))%>%
  mutate(aircrafts = `??/?? CL415`+`??/?? CL215`+`??/?? PZL`+`??/?? GRU.`,
         rented_aircr = c(rep(0,n()-1),sum(fires_2021$`????????. ????????????.`, na.rm = TRUE)),
         aggregate = ???????? + `???????????? ????????????` + ???????? + `?????????????????? ????????????????` + `????????/?????? ????????????????` + 
           `?????????????????????? ????????????????????????` + `?????????????? - ????????????` + ?????????????????????????? )

my_df_2$rented_aircr[nrow(my_df_2)]
sum(fires_2021$`????????. ??????????????.`, na.rm = TRUE)


we =
  my_df_2%>%
  filter(aggregate>5000)%>%
  group_by(year)%>%
  summarise(avg_fire_fight_1 = mean(`??????????. ????????`, na.rm = TRUE), fire_fight_1 = sum(`??????????. ????????`, na.rm = TRUE),
            avg_fire_vehicles_1 = mean(`??????????. ????????.`, na.rm = TRUE), sum_aircrafts_1 = sum(aircrafts,na.rm = TRUE),
            sum_fire_vehicles_1 = sum(`??????????. ????????.`, na.rm = TRUE),avg_fire_vehicles_ota_1 = mean(`????????. ??????`, na.rm = TRUE),
            sum_fire_helic_1 = sum(`??????????- ??????????`, na.rm = TRUE), sum_fire_vehicles_ota_1 = sum(`????????. ??????`, na.rm = TRUE),
            acres_avg_1 = mean(aggregate, na.rm = TRUE), mega = n(),avg_fire_helic_1 = mean(`??????????- ??????????`, na.rm = TRUE),
            avg_aircrafts_1 = mean(aircrafts,na.rm = TRUE))

firefight_per_year = 
  my_df_2 %>%
  group_by(year)%>%
  summarise(avg_fire_fight = mean(`??????????. ????????`, na.rm = TRUE), fire_fight = sum(`??????????. ????????`, na.rm = TRUE),
            avg_fire_vehicles = mean(`??????????. ????????.`, na.rm = TRUE), sum_aircrafts = sum(aircrafts,na.rm = TRUE),
            avg_aircrafts = mean(aircrafts,na.rm = TRUE),avg_fire_helic = mean(`??????????- ??????????`, na.rm = TRUE),
            sum_fire_vehicles = sum(`??????????. ????????.`, na.rm = TRUE),avg_fire_vehicles_ota = mean(`????????. ??????`, na.rm = TRUE),
            sum_fire_helic = sum(`??????????- ??????????`, na.rm = TRUE), sum_fire_vehicles_ota = sum(`????????. ??????`, na.rm = TRUE),
            fires = n(), acres_avg = mean(aggregate, na.rm = TRUE))%>%
  mutate(avg = acres_burnt_per_year$avg[12:22])

full = merge(we, firefight_per_year)
full_1 = subset(full, select = c("avg_fire_fight_1","avg_fire_helic_1",'avg_aircrafts_1','avg_fire_vehicles_1',
                               "avg_fire_fight","avg_fire_helic",'avg_aircrafts','avg_fire_vehicles', 'year'))
full_1_1 = subset(full, select = c("avg_aircrafts_1", "avg_fire_helic_1",'acres_avg_1','year'))
full_1_1melted
full_1
full_1_melted = gather(full_1, key = 'var', value = 'value', - year)
full_1_1melted = gather(full_1_1, key = 'var', value = 'value', - c(year,acres_avg_1))

plot_44 = 
full_1_1melted%>%
  ggplot()+
  geom_hline(yintercept = c(0,5,10,15), linetype = 'solid', colour = 'grey')+
  geom_line(aes(x = as.factor(year),y = value,  col = var, group = var), size = 2)+
  geom_col(aes(x = as.factor(year),y = acres_avg_1/20000, fill = acres_avg_1), width = 0.5, alpha = 0.6, group = 1)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.border = element_rect(fill = 'transparent', colour = 'black', size = 2),
        plot.background = element_rect(fill = 'white'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 3, b = 26)),
        plot.caption = element_text(face = 'italic', size = 6),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -20, b = 5), size = 8),
        axis.title.x = element_text(margin = margin(t = 20,b = 20), face = 'bold', size = 10),
        axis.text.x = element_text(angle = 90, size = 10, face = 'bold'),
        axis.text.y  = element_text(angle = 0, size = 11, face = 'bold'),
        axis.title.y.left = element_text(margin = margin(r = 10), face = 'bold'),
        axis.title.y.right = element_text(margin = margin(l = 10), face = 'bold'),
        legend.title = element_blank(),
        #legend.background = element_rect(fill = 'white'),
        legend.key.size  = unit(0.5,'cm'),
        legend.text = element_text(face = 'bold', size = 12), 
        legend.background = element_rect(fill = 'white'), 
        legend.position = 'bottom')+
  labs(title = 'Average Acres Burnt\n& Average Aircrafts and Helicopters', subtitle = 'in Greek Megafires, since 2011',
       y = 'Aircrafts\n& Helicopters', 
       x="Year",caption = "Source: firesercvice.gr")+
  scale_y_continuous( sec.axis = sec_axis(~ . *1000, name = 'Hectares'))+
  scale_color_manual(values = c('black','yellow3'), labels = c('Aircrafts', "Helicopters"))+
  scale_fill_gradient(low = 'darkgrey', high = 'orange3')+
  guides(color=guide_legend("var"), fill = 'none')

full_1_1
plot_44
dev.size("in")
ggsave('ggtest.png', plot_44, width =  4.2, height = 5.2, dpi = 1200)
  


Ffull_1_1melted
firefight_per_year[11,"sum_aircrafts"] = firefight_per_year[11,"sum_aircrafts"] + 210# We add the rented aircrafts of 2021
firefight_per_year[11,"sum_fire_helic"] = firefight_per_year[11,"sum_fire_helic"] + 317

firefight_per_year_melted = gather(firefight_per_year, key = 'var', value = 'value', -c(avg_fire_fight,fire_fight, avg_fire_vehicles,
                                                                                        avg_fire_vehicles_ota,fires, avg, mega, year))

firefight_per_year_melted%>%
  ggplot(aes(x = year))+
  geom_col(aes(y = value, fill = var),width = 0.5)+
  geom_line(aes(y = fires),group = 1, size = 2, colour = 'red')+
  scale_fill_manual(values = c('black','red','orange3','darkgrey'))

firefight_per_year

plot_9 = 
  firefight_per_year%>%
  ggplot(aes(x = as.factor(year)))+
  #geom_hline(yintercept = c(50,75,100,125), linetype = 'dotted', colour = 'black')+
  geom_col(aes(y = fire_fight/100),width = 0.5, colour = 'black', group = 1)+
  geom_line(aes(y = sum_aircrafts),size = 2.5, colour = 'orange3', group = 1)+
  geom_line(aes(y = sum_fire_helic),size = 2.5, colour = 'grey', group = 1, linetype = 'solid')+
  #geom_line(aes(y = sum_aircrafts),size = 2, colour = 'black', group = 1, linetype = 'solid')+
  #geom_line(aes(y = fires/10),size = 2, colour = 'orange', group = 1)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.border = element_rect(fill = 'transparent', colour = 'black', size = 3),
        plot.title = element_text(hjust = 0.5, size = 15, face = 'bold', margin = margin(t=10, b=30, l=0, r=0)),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic',margin = margin(t=-23, b=15, l=0, r=0)),
        plot.caption =  element_text(face = 'italic', size = 8), 
        axis.line.x = element_blank(),
        axis.line.y = element_line(linetype = 'solid'), 
        axis.title.x = element_text(hjust=1, face = 'bold', vjust = 1.05, angle = 0, margin = margin(t=10,b=0,l=20,r=-52) ),
        axis.title.y.left = element_text(vjust = 0.98, face = 'italic', angle = 0, margin = margin(t=0,b=0,l=40,r=-78)),
        axis.text.x = element_text(angle = 90, size = 11, face = 'bold'),
        axis.text.y = element_text(angle = 0, size = 11, face = 'bold'),
        axis.title.y.right = element_text(vjust = 1.05, hjust = 1, face = 'italic', angle = 0, margin = margin(t=0,b=0,l=-72,r= 0))
        )+ labs (title = "Average number of Firefighters per fire", subtitle =  'in Greece between 2011 and 2021',
                 caption = 'Source: fireservice.gr', x = 'Year')+
  scale_y_continuous('Firefighters',sec.axis = sec_axis(~ . *100, name = 'Acres, on average'))

plot_9

plot_6 = 
acres_burnt_per_year%>%
  ggplot(aes(x = year))+
  geom_line(aes(y = avg, group = 1), size = 1.2, color = 'darkred')+
  theme(panel.background = element_rect(fill = 'white'))


ggsave(
  "ggtest.png",
  plot_9,
  width = 6,
  height = 8,
  dpi = 1200
)

 
plot_6


# Fires per hour in 2021

fires_2021 = fires_2021%>%
  mutate(time = strptime(fires_2021$`?????? ??????????????`, format = "%H:%M"))%>%
  mutate(hour = lubridate::hour(time))

fires_per_hour = fires_2021%>%
  group_by(hour)%>%
  summarise(fires = n())

fires_per_hour%>%
  ggplot(aes(x = hour, y = fires))+
  geom_area(colour = 'black', fill = '#fb7604', alpha = 0.8, size = 1.2)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.y = element_line(linetype = 'solid', colour = 'black'),
        panel.grid.major.x = element_line(linetype = 'dotted', colour = 'black'),
        #axis.line.x = element_line(linetype = 1, size = 0.1),
        axis.line.y = element_line(linetype = 1, size = 0.1),
        axis.title.x = element_text(face = 'bold',hjust = 1, margin = margin(t = 15, b = 0, r = 20)),
        axis.title.y = element_text(face = 'bold', vjust = 1.05, angle = 0, margin = margin(r = -30, l = 20)),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(b = 30, t = 20)),
        plot.caption = element_text(size = 7, face = 'italic'),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -25, b = 60)))+
  labs(title = 'Fires per Hour in 2021 WildFires', subtitle = 'in Greece', x = 'Hour',
       y = 'Fires', caption = 'Source: fireservice.gr')+
  scale_x_discrete(limits = seq(0,23,2))

graph1.animation = graph_1 +
  transition_time(hour)+
  labs(subtitle = "hour : {frame_time}") 


# Total Fires per Month in 2000-2021
plot_12 = 
  my_df%>%
  group_by(w = lubridate::month(my_df$`????????/?????? ??????????????`))%>%
  summarise(fires = n())%>%
  mutate(month = factor(1:12, labels = month.abb[1:12]), 
         temp = temp_prec_month$`Mean-Temperature`)%>%
  ggplot(aes(x = month))+
  geom_col(aes(y = temp/100), alpha = 0.8, fill = 'black')+
  geom_line(aes(y = fires/223261),group = 1, size = 3, colour = 'red4')+
 #geom_point(size = 3.5, color = 'darkorange')+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(fill = 'white'),
        panel.border = element_rect(colour = 'black', fill = 'transparent', size = 2),
        panel.grid.major.y = element_line(linetype = 'dotted', colour = 'black'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 5, b = 7), size = 9),
        plot.caption = element_text(face = 'italic', size = 3, margin = margin(t = 2)),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -3, b = 10), size = 6),
        axis.title.x = element_text(margin = margin(b = 0, t = 5), face = 'bold', size = 6, hjust = 1),
        axis.title.y.left =  element_text(margin = margin(r = -51,l =34), face = 'bold.italic',
                                            vjust = 0.96, angle = 0, size = 8, colour = 'red4'),
        axis.title.y.right = element_text(margin = margin(r = 37,l =-26), face = 'bold.italic',
                                            vjust = 0.96, angle = 0, size = 8, colour = 'black'),
        axis.text.y = element_text(face = 'bold', size = 8),
        axis.ticks.length = unit(0.07,'cm'),
        axis.text.x = element_text(face = 'bold', size = 8))+
  labs(title = 'Total number of Forest Fires & Mean Temperature per month', 
       subtitle = 'in Greece between 2000 and 2021',
       x = 'Month', y = "Fires", caption = 'Source: fireservice.gr')+
  scale_y_continuous(sec.axis = sec_axis(~.*100, name = 'C'))
?sec_axis


ggsave('ggtest.png',plot_12, width = 4.6, height = 2.5, dpi = 800)

plot_12 
ggsave("ggtest.png",plot_12, height =2.6, width =  4.5, dpi = 800)

animate_plot = plot_23+
  tra


my_df%>%
  group_by_all(w = lubridate::month(`????????/?????? ??????????????`), 
               y =lubridate::year(`????????/?????? ??????????????`))


# State Funding of Forest Dpts in six Decentralised Administriations.(+ Fireservice Funding)

money = read.xlsx(file.choose(), sheetIndex = 1)

money = na.omit(money)

money$Authority = as.factor(money$Authority)
money$Year  = as.factor(money$Year)

plot_55 = 
money %>%
  filter(Authority == 'T_PY_S')%>%
  ggplot(aes(x = Year, y = Amount1/10^6))+
  geom_hline(yintercept = seq(380,500,40), colour = 'grey')+
  geom_line(size = 2, group = 1, colour = 'red3')+
  theme(panel.background = element_rect(fill = 'white'),
        panel.border = element_rect(colour = 'black', fill = 'transparent', size = 2),
        plot.background = element_rect(color = 'black'),
        plot.title = element_text(face = 'bold', hjust = 0.5, margin = margin(b = 10,t = 5), size = 12),
        plot.subtitle = element_text(face = 'italic', hjust = 0.5, margin = margin(t=-5, b= 40), size =8 ),
        plot.caption = element_text(face = 'italic', size = 6),
        axis.title.y = element_text(face = 'italic',angle = 0 , vjust =1.12 , margin = margin(r = -102, l= 25)),
        axis.text.y = element_text(size = 11, face = 'bold'),
        axis.title.x = element_text(margin = margin(t = 20), face = 'italic' ),
        axis.text.x = element_text(face = 'bold', angle = 90, size = 10),
        legend.title = element_text(face = 'bold'),
        legend.background = element_rect(fill = 'white'), 
        legend.key = element_rect(fill = 'transparent'))+
  labs(title = 'Funding of Fire Service ',subtitle = 'in Greece between 2017 and 2022*',
       y = 'EUR, in millions', caption = 'Source: apdattikh.gr,apddepin.gr,\napdthest.gr,apdaigaiou.gr,apdhpdm.gr')+
  scale_y_continuous(breaks = seq(380,500,40))
  #scale_color_manual(values = c('black', 'darkgreen','yellow', 'red4', 'firebrick','lightgrey'))
                     #labels = c('1','2','3','4','5','6')
plot_55
dev.size("in")
ggsave("ggtest.png",plot_55, height = 4.4, width = 3.2, dpi = 800)

str(money)

# Rate of change in Funding in APD and PY.S since 2018(data availability)

r1 =
  (money[(money$Authority == "PY_S") & (money$Year == '2018'),"Amount1"] - money[(money$Authority == "PY_S") & (money$Year == '2017'),"Amount1"])/
  money[(money$Authority == "PY_S") & (money$Year == '2017'),"Amount1"]


r2 =
  (money[(money$Authority == "PY_S") & (money$Year == '2019'),"Amount1"] - money[(money$Authority == "PY_S") & (money$Year == '2018'),"Amount1"])/
  money[(money$Authority == "PY_S") & (money$Year == '2018'),"Amount1"]


r3 =
  (money[(money$Authority == "PY_S") & (money$Year == '2020'),"Amount1"] - money[(money$Authority == "PY_S") & (money$Year == '2019'),"Amount1"])/
  money[(money$Authority == "PY_S") & (money$Year == '2019'),"Amount1"]
r4 = 
  (money[(money$Authority == "PY_S") & (money$Year == '2021'),"Amount1"] - money[(money$Authority == "PY_S") & (money$Year == '2020'),"Amount1"])/
  money[(money$Authority == "PY_S") & (money$Year == '2020'),"Amount1"]


diff_2019 = money%>%
  filter((Year == '2019' | Year == '2018') & (Authority != 'PY_S')&(Authority != 'T_PY_S') &(Authority != 'APD-DEPIN'))%>%
  group_by(Year)%>%
  summarise(total = sum(Amount1))

diff_2019
ratio_change_2019 = (diff_2019$total[2]-diff_2019$total[1])/diff_2019$total[1]

nice = data.frame(year = as.factor(c(2019,2020,2021,2019,2020,2021)), 
                  change =  c(r2,r3,r4,
                              ratio_change_2019,
                              0.0165,-0.056),
                  authority = c(rep('pys', 3),rep("apd",3)))



nice%>%
  ggplot(aes(x = year, y = change*100, fill = authority ))+
  geom_col(width = 0.1)+
  scale_fill_manual(values = c('darkgreen', 'red2'))+
  geom_hline(yintercept=0, color = 'black', linetype = 'solid', size = 1)+
  theme(panel.background = element_rect(fill = 'white'),
        panel.grid.major.x = element_line(linetype = 'dotted', colour = 'black'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 10, b = 30)),
        plot.caption = element_text(face = 'italic', size = 6),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -20, b = 30)),
        axis.title.x = element_text(margin = margin(t = 20,b = 20), face = 'bold', size = 10),
        axis.title.y = element_text(margin = margin(r = 40), face = 'bold'),
        legend.title = element_text(face = 'bold'),
        legend.background = element_rect(fill = 'white', colour = 'black'),
        legend.text = element_text(face = 'bold', labels = c("APD", "PYS")))+
  labs(title = 'Rate of change in Funding per year', subtitle = 'since 2018',
       y = 'Change (%)', 
       x="Year",caption = "Source: firesercvice.gr, apd..gr ")+
  scale_y_continuous(breaks = c(-5, 0,10,25, 40))+
  coord_flip()
  


# The same but using the aggregate funnding on PY.S

r11 =
  (money[(money$Authority == "T_PY_S") & (money$Year == '2018'),"Amount1"] - money[(money$Authority == "T_PY_S") & (money$Year == '2017'),"Amount1"])/
  money[(money$Authority == "T_PY_S") & (money$Year == '2017'),"Amount1"]
r22 =
  (money[(money$Authority == "T_PY_S") & (money$Year == '2019'),"Amount1"] - money[(money$Authority == "T_PY_S") & (money$Year == '2018'),"Amount1"])/
  money[(money$Authority == "T_PY_S") & (money$Year == '2018'),"Amount1"]
r33 =
  (money[(money$Authority == "T_PY_S") & (money$Year == '2020'),"Amount1"] - money[(money$Authority == "T_PY_S") & (money$Year == '2019'),"Amount1"])/
  money[(money$Authority == "T_PY_S") & (money$Year == '2019'),"Amount1"]
r44 = 
  (money[(money$Authority == "T_PY_S") & (money$Year == '2021'),"Amount1"] - money[(money$Authority == "T_PY_S") & (money$Year == '2020'),"Amount1"])/
  money[(money$Authority == "T_PY_S") & (money$Year == '2020'),"Amount1"]

r55 = 
  (money[(money$Authority == "T_PY_S") & (money$Year == '2022'),"Amount1"] - money[(money$Authority == "T_PY_S") & (money$Year == '2021'),"Amount1"])/
  money[(money$Authority == "T_PY_S") & (money$Year == '2021'),"Amount1"]

diff_2022 = money%>%
  filter((Year == '2021' | Year == '2022') & (Authority != 'PY_S')&(Authority != 'T_PY_S'))%>%
  group_by(Year)%>%
  summarise(total = sum(Amount1))

ratio_change_2022 = (diff_2022$total[2]-diff_2022$total[1])/diff_2022$total[1]

nice_1 = data.frame(year = as.factor(c(2019,2020,2021,2022,2019,2020,2021,2022)), 
                    change =  c(r22,r33,r44,r55,
                              ratio_change_2019,0.0165,-0.056,ratio_change_2022),
                    authority = c(rep('pys', 4),rep("apd",4)))

nice_1

plot_66 = 
nice_1%>%
  ggplot(aes(x = year, y = change*100, fill = authority ))+
  geom_col(width = 0.2)+
  scale_fill_manual(values = c('darkgreen', 'red2'), labels = c("AP.D", "PY.S")
                    )+
  geom_hline(yintercept=0, color = 'black', linetype = 'solid' , size = 1)+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(fill = 'white', color = 'black'),
        panel.grid.major.x = element_line(linetype = 'dotted', colour = 'black'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 10, b = 30), size = 14),
        plot.caption = element_text(face = 'italic', size = 6),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -20, b = 10)),
        axis.title.x = element_text(margin = margin(t = 20,b = 15), face = 'bold', size = 12),
        axis.title.y = element_text(margin = margin(r = 40), face = 'bold'),
        axis.text.x = element_text(size = 12, face = 'bold'),
        axis.text.y = element_text(size = 12, face = 'bold'),
        legend.title = element_blank(),
        #legend.background = element_rect(fill = 'white'),
        legend.key.size  = unit(0.5,'cm'),
        legend.text = element_text(face = 'bold'), 
        legend.background = element_rect(fill = 'white'))+
  labs(title = 'Rate of change in Funding per year', subtitle = 'in Greece since 2018',
       y = 'Change (%)', 
       x="Year",caption = "Source: firesercvice.gr, apd..gr ")+
  scale_y_continuous(breaks = c(-5, 0,5,10))+
  coord_flip()
plot_66
dev.size("in")
ggsave("ggtest.png",plot_66, height = 3.5, width = 5.5, dpi = 1200)

# Now, we try to examine the number of fires in PARNITHA through the years. This is because PARNITHA is of significant importnce for the capital.

which(fires_2020$???????????????? == '??.??. ????????????????')

sum(
fires_2007%>%
  filter(???????????????? == "10???? ??.??. ????????????" |???????????????? == "12???? ??.??. ????????????" | ???????????????? =="1???? ??.??. ????????????"|
                   ???????????????? =="2???? ??.??. ????????????"|???????????????? == "4???? ??.??. ????????????"|???????????????? =="6???? ??.??. ????????????"|
                   ???????????????? == "9???? ??.??. ????????????"|???????????????? == "??.??. ??????????????????"|???????????????? == "??.??. ??????????????"|
                   ???????????????? == "??.??. ??????????????????"|???????????????? == "??.??. ???????? ????????????")%>%
  select(`???????????? ????????????`,????????)
)

sum(
  fires_2007%>%
    filter(?????????? == '??????????????')%>%
    select(????????))

urban_fires_2019 = read_xlsx(file.choose())
urban_fires_2020 = read_xlsx(file.choose())
urban_fires_2021 = read_xlsx(file.choose())

mean(urban_fires_2019$`???????????? ??????. ???????????????? (???? ???????????? ?????? ????????????????)`, na.rm = TRUE)/mean(fires_2019$`??????????. ????????`, na.rm = TRUE)


mean(urban_fires_2019$`???????????? ??????. ????????????????`)/mean(fires_2019$`??????????. ????????.`)# Here we check the ratio of human power and vehicles
                                                                             # between urban and forest fires as a way for estimating
                                                                             # the amount of Fireservice workload allocated to to the latter
# Defunding of Local Authorities for Fire Prevention
money_1 = read_xlsx(file.choose())
money_1_melted  = gather(money_1, key = 'status', value = 'value', Needed, Given)
ggsave("ggtest.png",
       money_1_melted%>%
  ggplot(aes(x = Year, y =  value/10^6, colour = status))+
  geom_line(size = 2)+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(fill = 'white'),
        panel.border = element_rect(colour = 'black', fill = 'transparent', size = 2),
        panel.grid.major.y = element_line(linetype = 'dotted', colour = 'black'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 0, b = 15), size = 9),
        plot.caption = element_text(face = 'italic', size = 3),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic', margin = margin(t = -12, b = 5), size = 6),
        axis.title.x = element_text(margin = margin(b = 0, t = 5), face = 'bold', size = 7, hjust = 0.993),
        axis.text.y = element_text(face = 'bold', size = 9),
        axis.ticks.length = unit(0.05,'cm'),
        axis.text.x = element_text(face = 'bold', size = 8),
        axis.title.y = element_text(margin = margin(r = -75,l = 25), face = 'bold.italic', vjust = 0.96, angle = 0, size = 8),
        legend.title = element_blank(),
        #legend.background = element_rect(fill = 'white'),
        legend.key.size  = unit(0.5,'cm'),
        legend.text = element_text(face = 'bold', size = 8), 
        legend.background = element_rect(fill = 'white'), 
        legend.position = 'bottom')+
  labs(title = "Forestry Dpts Funding for Fire Prevention*", subtitle = 'in Greece between 2016 and 2022*',
       y = '???, in millions', caption = 'Source: dasarxeio.com, exegersis.com, 902.gr')+
  scale_y_continuous(breaks = c(1,2,14,18))+
  scale_colour_manual(values = c('black', 'darkgreen'), labels = c("Actual","Expected")), height = 3.9, width = 3.1, dpi = 800)
    my_df$year = as.integer(my_df$year)
str(my_df)
dev.size("in")

my_df = 
  my_df%>%
  mutate(year = lubridate::year(`????????/?????? ??????????????`))
Sys.setlocale(category = "LC_ALL", locale = "Greek")

j= 
my_df%>%
  group_by(year>=2010)%>%
  summarise(acres = sum(aggregate))
sum(j$acres, na.rm = TRUE)
j_1= 
  my_df%>%
  group_by(year>=2010)%>%
  summarise(acres = sum(aggregate))


j_2= 
  my_df%>%
  filter(year>=2010)%>%
  group_by(year)%>%
  summarise(fires = n())

j_2
mean(j_2$fires,na.rm = TRUE)

sum(j$acres,na.rm = TRUE)  

sum(
  my_df%>%
  filter(year>= 2010)%>%
  select(????????))



#MEGAFIRES(5000>)
mega=my_df%>%
  filter(aggregate > 5000)%>%
  group_by(year)%>%
  summarise(megafires = n(), acres = sum(aggregate, na.rm = TRUE), avg = mean(aggregate))


mega

mega=
  mega%>%
  add_row(megafires = 0 , year = '2002', acres = 0, .before = 3)%>%
  add_row(megafires = 0 , year = '2003', acres = 0,.before = 4)%>%
  add_row(megafires = 0 , year = '2004', acres = 0, .before = 5)
mega_fires_2
plot_22 = 
  mega_fires_1%>%
  ggplot(aes(x = year))+
  geom_hline(yintercept = c(50,100,150,200,250), colour = 'grey')+
  geom_area(aes(y = acres/10^4), fill = 'orange', group = 1)+
  geom_area(aes(y = total/10^4), fill = 'black', group = 1, alpha = 0.2)+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(fill = 'white'),
        panel.border = element_rect(colour = 'black', fill = 'transparent', size = 2),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 10, b = 15), 
                                  size = 11),
        plot.caption = element_text(face = 'italic', size = 3, margin = margin(t = 2)),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic',
                                     margin = margin(t = -10, b = 5), size = 7),
        axis.title.x = element_text(margin = margin(b = 0, t = 5),
                                    face = 'bold', size = 8, hjust = 0.993),
        axis.text.y = element_text(face = 'bold', size = 10),
        axis.ticks.length = unit(0.1,'cm'),
        axis.text.x = element_text(face = 'bold', size = 10, angle = 90),
        axis.title.y = element_text(margin = margin(r = -108,l = 35), 
                            face = 'bold.italic', vjust = 0.96, angle = 0, size = 9))+
  labs(title = "Area Burnt in Megafires vs Total Burnt Area", x = "Year", y = 'Ha, in thousands', 
       subtitle = 'in Greece between 2000 and 2021', caption = 'Source: fireservice.gr')+
  scale_y_continuous(breaks = c(50,100,150,200, 250))
plot_22
ggsave("ggtest.png",plot_22, height = 3, width = 5, dpi = 1200)


mega_fires_1 = merge(mega, acres_burnt_per_year)
mega_fires_2 =
  mega_fires_1%>%
  mutate(ratio_fires = (megafires/fires)*100, ratio_acres = (acres/total)*100, rest_ratio = 100-ratio_acres,
         rest_ratio_1 = 1 - ratio_fires)


  

mega_fires_2_1 = subset(mega_fires_2, select = c('ratio_fires', 'rest_ratio_1', 'year'))
mega_fires_1_2 = subset(mega_fires_1, select = c('acres', 'total', 'year'))
mega_fires_2_1
library(forcats)
library(scales)    


mega_fires_2_1_melted = gather(mega_fires_2_1, key = 'var', value = 'value', -year)
mega_fires_2_1_melted$var = fct_relabel(mega_fires_2_1_melted$var,  'MegaFires', 'Fires')

plot_33 = 
  mega_fires_2_1%>%
  ggplot(aes(x = year, y = ratio_fires, fill = ratio_fires))+
  geom_hline(yintercept =c(0.2, 0.3, 0.1), size = 0.5, colour = "grey", linetype = "solid") +
  geom_col(width = 0.4)+
  #coord_flip()+
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(colour = 'black', fill = 'white'),
        #panel.grid.major.y = element_line(linetype = 1, colour = 'black'),
        plot.title = element_text(hjust = 0.5, face = 'bold', margin = margin(t = 3, b = 15), 
                                  size = 11),
        plot.caption = element_text(face = 'italic', size = 3, margin = margin(t = 2)),
        plot.subtitle = element_text(hjust = 0.5, face = 'italic',
                                     margin = margin(t = -10, b = 5), size = 7),
        axis.title.x = element_text(margin = margin(b = 0, t = 5),
                                    face = 'bold', size = 8, hjust = 1),
        axis.text.y = element_text(face = 'bold', size = 11),
        axis.ticks.length = unit(0.1,'cm'),
        axis.text.x = element_text(face = 'bold', size = 9, angle = 90),
        axis.title.y = element_text(margin = margin(r = -15,l = 0), 
                                    face = 'bold', vjust = 1.02, angle = 0, size = 11),
        legend.position = 'none')+
  labs(title = "Percentage of Megafires per year", x = "Year", y = '(%)', 
       subtitle = 'in Greece between 2000 and 2021', caption = 'Source: fireservice.gr')+
  scale_fill_gradient(low = 'darkgray', high = 'orange3')
  #scale_y_di(breaks = seq(0.01,0.3, 0.05))

plot_33
dev.size("in")
ggsave('ggtest.png', plot_33, width =  4.6, height = 4.4, dpi = 1200)


my_df_3 = rbind(fires_2011_fixed,fires_2012_fixed,fires_2013_fixed,fires_2014_fixed, 
                fires_2015_fixed, fires_2016_fixed, fires_2017_fixed, fires_2018_fixed, 
                fires_2019_fixed, fires_2020_fixed, fires_2021_fixed)




